---
import { getLang, getTranslations } from '@utils/i18'
import { getImage } from 'astro:assets'
import CauseTitleEn from '../assets/titles/en/cause-title.svg'
import CauseTitleBg from '../assets/titles/bg/cause-title.svg'

const lang = getLang(Astro.params)

const causeTitle = await getImage({
  src: lang === 'bg' ? CauseTitleBg : CauseTitleEn,
  widths: [200, 400],
  formats: ['avif', 'webp', 'png'],
  quality: 80,
  alt: 'Cause Title',
})
const translations = getTranslations(Astro.params)
---

<dialog
  id="contactFormModal"
  class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2
         pb-20 px-7 lg:pb-15 lg:px-10
         w-screen h-screen lg:w-125 lg:h-fit
         max-w-none max-h-none
         shadow-lg
         overflow-hidden
         backdrop:bg-black/50 backdrop:backdrop-blur-sm"
>
  <div class="flex flex-col h-full overflow-y-auto">
    <form
      method="dialog"
      class="flex justify-end w-full h-20 lg:h-15 sticky top-0"
    >
      <button type="submit" aria-label="Close modal" class="p-2">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </form>
    <h2 class="flex items-center justify-center text-3xl font-bold mb-10">
      <span> {translations.contactForm.support} </span>
      <img
        class="h-[40px] lg:h-[50px] w-fit ml-2 lg:ml-4"
        src={causeTitle.src}
        {...causeTitle.attributes}
      />
    </h2>
    <p class="text-center mb-7">
      <b class="text-xl">{translations.contactForm.description1}</b>
      <span class="text-lg lg:text-xl block">
        {translations.contactForm.description2}
      </span>
    </p>
    <form class="flex flex-col gap-7 flex-1" method="post">
      <input
        placeholder={translations.contactForm.namePlaceholder}
        type="text"
        id="name"
        name="name"
        class="w-full p-2 border-b border-black mb-4 bg-[#f7f7f7] h-15"
      />
      <input
        placeholder={translations.contactForm.emailPlaceholder}
        type="email"
        id="email"
        name="email"
        class="w-full p-2 border-b border-black mb-4 bg-[#f7f7f7] h-15"
      />
      <textarea
        placeholder={translations.contactForm.messagePlaceholder}
        id="message"
        name="message"
        rows="4"
        class="w-full p-2 border-b border-black mb-4 bg-[#f7f7f7] flex-1"
      ></textarea>
      <button
        type="submit"
        data-submit-contact-form
        class="m-auto bg-black text-white text-xl px-11 py-2 uppercase"
      >
        {translations.contactForm.submit}
      </button>
    </form>
  </div>
</dialog>

<script>
  document.addEventListener('astro:page-load', () => {
    const dialog =
      document.querySelector<HTMLDialogElement>('#contactFormModal')
    const submitButton = document.querySelector('[data-submit-contact-form]')
    const form = submitButton?.closest('form')
    form?.addEventListener('submit', (e) => {
      dialog?.close()
    })
  })
</script>
